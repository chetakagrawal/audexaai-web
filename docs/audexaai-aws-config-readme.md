# AudexaAI — AWS Deployment Configuration Guide

This README documents **all AWS infrastructure configuration** required to deploy
the AudexaAI landing page using:

- **Next.js static export**
- **Amazon S3 (private bucket)**
- **Amazon CloudFront (CDN + HTTPS)**
- **AWS Certificate Manager (SSL)**
- **Route53 DNS**
- **GitHub Actions CI/CD**

It is intended as a **repeatable, end‑to‑end guide** for rebuilding or extending
the deployment in the future.

---

# 1. Overview of Final Architecture

```
GitHub Actions → S3 Bucket (private)
                     ↓
         CloudFront Distribution (HTTPS, CDN)
                     ↓
              Route53 Hosted Zone
                     ↓
         audexaai.com / www.audexaai.com
```

### Key AWS Components
| Component | Purpose |
|----------|---------|
| **S3 bucket** | Stores static website files (private) |
| **OAC (Origin Access Control)** | Allows CloudFront to securely read from S3 |
| **CloudFront** | Serves site globally over HTTPS with caching |
| **ACM certificate** | Enables HTTPS for your domain |
| **Route53** | Routes DNS to CloudFront |
| **NameBright** | Registrar, delegates DNS to Route53 |

---

# 2. S3 Configuration (Private Static Hosting)

### 2.1 Create the Bucket
Create a bucket, e.g.:

```
audexaai
```

### 2.2 Bucket Requirements
- ❌ *Do not enable public access*
- ❌ *Do not enable bucket website hosting*
- ✔️ The bucket must remain **private**
- ✔️ CloudFront will access it through **Origin Access Control (OAC)**

### 2.3 Files Uploaded
The deployment pushes all files from:

```
out/
```

Generated by:

```sh
pnpm build
```

Uploaded via:

```sh
aws s3 sync out/ s3://audexaai --delete
```

---

# 3. CloudFront Configuration

### 3.1 Create Distribution
Create a new **Web Distribution** with:

#### **Origin Domain**
Select S3 bucket origin:
```
audexaai.s3.us-east-1.amazonaws.com
```

CloudFront will automatically attach OAC (Origin Access Control).

> Note: This uses the **REST API endpoint**, not the website hosting endpoint,
> because the bucket is private.

### 3.2 Origin Access Control (OAC)
CloudFront automatically generates:

- An OAC identity
- A bucket policy that grants CloudFront permission to access S3

This ensures:
- S3 bucket stays **private**
- CloudFront is the only reader

### 3.3 Default Cache Behavior
| Setting | Value |
|--------|--------|
| Viewer protocol policy | Redirect HTTP → HTTPS |
| Allowed methods | GET, HEAD |
| Cache Policy | `Managed-CachingOptimized` |
| Compression | Enabled |

### 3.4 Alternate Domain Names (CNAMEs)
Add:

```
audexaai.com
www.audexaai.com
```

### 3.5 SSL Certificate
Attach the ACM certificate created in us-east-1 containing:

```
audexaai.com
www.audexaai.com
```

### 3.6 Default Root Object
Set:

```
index.html
```

---

# 4. Certificate Manager (ACM)

### 4.1 Request Certificate
In **us-east-1**, request certificate for:

```
audexaai.com
www.audexaai.com
```

### 4.2 DNS Validation
ACM generates CNAME validation records such as:

```
_acme-challenge.audexaai.com → *.acm-validations.aws.
_acme-challenge.www.audexaai.com → *.acm-validations.aws.
```

Add these to Route53.

### 4.3 Certificate Status
Must show:

```
ISSUED
```

Only then CloudFront can attach it.

---

# 5. Route53 Configuration (DNS Hosted Zone)

### 5.1 Create Hosted Zone
Create a public hosted zone for:

```
audexaai.com
```

### 5.2 Required Records

#### Root Domain (A Alias → CloudFront)
| Type | Name | Value |
|------|-------|--------|
| A (Alias) | audexaai.com | CloudFront distribution |

#### WWW Domain (CNAME → CloudFront)
| Type | Name | Value |
|------|-------|--------|
| CNAME | www.audexaai.com | `<CLOUDFRONT_ID>.cloudfront.net` |

#### ACM Validation Records
Auto‑generated CNAMEs for certificate validation.

### 5.3 NameBright Delegation
Copy the 4 **NS records** from Route53 and update NameBright:

```
ns-xxxx.awsdns-xx.com
ns-xxxx.awsdns-xx.net
ns-xxxx.awsdns-xx.org
ns-xxxx.awsdns-xx.co.uk
```

This gives AWS full DNS control.

---

# 6. GitHub Actions CI/CD Deployment

Workflow performs:

1. Checkout code
2. Install Node + pnpm
3. Build Next.js static export
4. Sync `/out` → S3
5. Invalidate CloudFront cache

### Required GitHub Secrets
| Secret | Description |
|--------|-------------|
| `AWS_ACCESS_KEY_ID` | IAM key |
| `AWS_SECRET_ACCESS_KEY` | IAM secret |
| `AWS_REGION` | Usually `us-east-1` |
| `S3_BUCKET` | e.g. `audexaai` |
| `CLOUDFRONT_DISTRIBUTION_ID` | CloudFront ID |

---

# 7. Manual Deployment Commands (If Needed)

```sh
pnpm build
aws s3 sync out/ s3://audexaai --delete
aws cloudfront create-invalidation --distribution-id <ID> --paths "/*"
```

---

# 8. Troubleshooting

### 403 AccessDenied
- CloudFront not allowed to access S3 → Check OAC bucket policy
- Wrong S3 bucket name in deployment
- CloudFront still caching old files → Invalidate cache

### Root or www not resolving
- Check Route53 A Alias + CNAME
- Ensure NameBright nameservers point to Route53

### SSL not working
- ACM certificate not issued
- Certificate not attached to CloudFront
- Certificate not created in **us-east-1**

---

# 9. Summary of Critical AWS Settings

| Component | Key Setting |
|----------|-------------|
| **S3** | Private bucket, no public access |
| **CloudFront** | S3 origin + OAC + SSL + CNAMEs |
| **ACM** | Issued cert in us-east-1 |
| **Route53** | Root + www records pointing to CloudFront |
| **GitHub Actions** | Deployment + invalidation |

---

# End of README

